## Запуск цепочки

Очередь: `chain`, параметры очереди: `durable: true`.

Тело запроса JSON:

```
{"id": "CHAIN_ID", "client_id": "CLIENT_ID", "rule_id": "RULE_ID", "args": {}}

```
## Запуск транзакционого сообщения

Очередь: `transactional`, параметры очереди: `durable: true`.

Тело запроса JSON:

```
{"id": "CAMPAIGN_ID", "client_id": "CLIENT_ID", "args": {}}
```

- `test` - флаг, что это тестовая отправка. При включении код письма не будет сгенерирован и отправка не попадет в статистику. По умолчанию false.
- `cc` - вторичные получатели письма, которым направляется копия.
- `bcc` - скрытые получатели письма, чьи адреса не показываются другим получателям.
- `files` - массив файлов приложенных как attach к письму, используется только для email кампаний. В массиве должно быть не больше 10 файлов и суммарный их размер не должен превышать 10 Мб. Объект файла:
  - `filename` - имя файла во вложении;
  - `content_type` - тип файла;
  - `data` - бинарные данные в base64.

## Вызов вебхука

Очередь: `notification`, параметры очереди:` durable: true`. Тип сообщения: `webhook`.

Тело запроса JSON:

```
{"type": "webhook", "url": "URL", "body": "String body data"}
```

Опциональные параметры тела запроса:

- `shop_id` - при наличии id магазина, ответ на запрос по указанному урлу будет добавлен в лог системных сообщений. Событие: `request`, тип продукта: `webhook`.
- `headers` - хеш заголовков: `{key => value}`

## Обработка YML

Очередь: `yml`, параметры очереди`: durable: true`.

Тело запроса JSON:

```
{"shop_id": SHOP_ID, "force": false}
```

## Уведомления

Очередь: `notification`, параметры очереди:` durable: true`. Тип сообщения: `notification`.

```
{"type": "notification", "shop_id": SHOP_ID, "notification_type": "technical", "subject": "Subject", "message": "Message body", "list_id": "yml_error"}
```
Где:

- `notification_type` - тип уведомления. Уведомляет клиентов только подписанных на данный тип. Доступные значения: `technical`
- `subject` - заголовок уведомления
- `message` - текст уведомления
- `list_id` - код шаблона уведомления. Доступные значения: `yml_error`.

## Системное событие

Очередь: `notification`, параметры очереди: `durable: true`. Тип сообщения: `system`.

```
{"type": "system", "shop_id": SHOP_ID, "event": EVENT, "client_id": CLIENT_ID, "clients": CLIENTS, "category": CATEGORY, "label": LABEL, "value": VALUE, "date": DATE, "created_at": CREATED_AT}
```

Обязательные поля: `shop_id`, `event` .

Если указано поле `clients` - оно в приоритете над `client_id`.

События:

- `client_left_segment` - клиент вышел из сегмента.
  - Обязательные поля: `category`, `client_id` OR `clients`
  - Дополнительные поля: `category`: Segment всегда статично, `label`: SEGMENT_ID ID сегмента, `value`: KEY_ID идентификатор процесса вставки (т.к. события в БД пишутся построчно, чтобы выбрать слепок клиентов при обработке сегмента)
- `client_into_segment` - клиент попал в сегмент.
  - Обязательные поля: `category`, `client_id` OR `clients`
  - Дополнительные поля: `category`: Segment всегда статично, `label`: SEGMENT_ID ID сегмента, `value`: KEY_ID идентификатор процесса вставки (т.к. события в БД пишутся построчно, чтобы выбрать слепок клиентов при обработке сегмента)
- `product_price_decrease` - цена на товар снижена. Данное событие срабатывает после обработки товара.
  - Поля `client_id`, `clients`, `category` не указываются.
  - Дополнительные поля: `items`: [ITEM_UNIQID] - массив товаров с которым произошло событие
- `product_available` - товар снова в наличии
  - Поля `client_id`, `clients`, `category` не указываются.
  - Дополнительные поля: `items`: [ITEM_UNIQID] - массив товаров с которым произошло событие

## Обработка заказа

Очередь: `order`, параметры очереди: `durable: true`.

```
{"type": "TYPE", "order_id": ORDER_ID, "params": PARAMS}
```

Типы:

- `persist` - обработка заказа после создания из события push
- `import` - импорт заказов через HTTP API
