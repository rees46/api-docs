# Loyalty program

Service provides endpoints for loyalty program management.


## Get balance
> Request example

```shell
curl 'https://<%= config[:api_endpoint] %>/loyalty/basic/balance?shop_id=SHOP_ID&shop_secret=SHOP_SECRET&phone=PHONE&order_total=ORDER_TOTAL'
```

> The above command returns JSON structured like this:

```json
{
    "confirmed": 123,
    "pending": 456,
    "expiring": 789,
    "expire_in": "2022-12-12 23:59:59 UTC",
    "available_in_order": 100, // How many bonuses can be spent in this purchase
    "payable_amount": 50 // How much it will in currency if exchange rate is not 1:1
}
```

Method return current bonuses balance.

### HTTP Request

`GET https://<%= config[:api_endpoint] %>/loyalty/basic/balance`

### Query Parameters

| Parameter   | Required | Description                          |
|-------------|----------|--------------------------------------|
| shop_id     | true     | Your API key                         |
| shop_secret | true     | Your API secret key                  |
| email*      | true     | User's email                         |
| phone*      | true     | User's phone number                  |
| expire_in   | optional | Bonuses expiration date (DD-MM-YYYY) |
| order_total | optional | Order total                          |

<aside class="notice">
At least of identifiers (marked by *) must present in request: email, phone. It's used to identify user.
</aside>


### API response

| Name                | Type     | Description                            |
|---------------------|----------|----------------------------------------|
| confirmed           | Int      | Available bonuses                      |
| pending             | Int      | Pending bonuses                        |
| expiring            | Int      | Bonuses that will be expired           |
| expire_in           | Datetime | Expiring period                        |
| available_in_order  | Int      | Available bonuses for use in the order |


## Get SMS code
> Request example

```shell
curl 'https://<%= config[:api_endpoint] %>/loyalty/basic/init_bonus_usage?shop_id=SHOP_ID&shop_secret=SHOP_SECRET&phone=PHONE&bonus_points=BONUS_POINTS'
```

> The above command returns JSON structured like this:

```json
{
    "status": "success",
    "sms_code": 123456
}
```

Method return SMS code.

### HTTP Request

`GET https://<%= config[:api_endpoint] %>/loyalty/basic/init_bonus_usage`

### Query Parameters

| Parameter     | Required | Description                              |
|---------------|----------|------------------------------------------|
| shop_id       | true     | Your API key                             |
| shop_secret   | true     | Your API secret key                      |
| email*        | true     | User's email                             |
| phone*        | true     | User's phone number                      |
| bonus_points  | true     | Bonuses, which client wants to validate  |

<aside class="notice">
At least of identifiers (marked by *) must present in request: email, phone. It's used to identify user.
</aside>


### API response

| Name               | Type     | Description                            |
|--------------------|----------|----------------------------------------|
| sms_code           | Int      | SMS code                               |


## Validate SMS code

> Request example

```shell
curl --location --request POST 'https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points?phone=PHONE&shop_id=SHOP_ID&shop_secret=SHOP_SECRET&bonus_points=BONUS_POINTS&confirm_code=true&sms_code=SMS_CODE'
```

> The above command returns JSON structured like this:

```json
{
    "confirmation": "success",
    "confirmed": 123456
}
```

Method validate SMS code.

### HTTP Request

`POST https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points`

### Query Parameters

| Parameter    | Required | Description                             |
|--------------|----------|-----------------------------------------|
| shop_id      | true     | Your API key                            |
| shop_secret  | true     | Your API secret key                     |
| email*       | true     | User's email                            |
| phone*       | true     | User's phone number                     |
| bonus_points | true     | Bonuses, which client wants to validate |
| confirm_code | true     | Param for validate                      |
| sms_code     | true     | SMS code                                |

<aside class="notice">
At least of identifiers (marked by *) must present in request: email, phone. It's used to identify user.
</aside>


### API response

| Name         | Type   | Description       |
|--------------|--------|-------------------|
| confirmation | String | Response message  |
| confirmed    | int    | Validated bonuses |

## Decrease bonuses

> Request example

```shell
curl --location --request POST 'https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points_confirmed?phone=PHONE&shop_id=SHOP_ID&shop_secret=SHOP_SECRET&bonus_points=BONUS_POINTS&sms_code=SMS_CODE'
```

> The above command returns JSON structured like this:

```json
{
    "confirmation": "success",
    "confirmed": 123456
}
```

Method decrease bonuses.

### HTTP Request

`POST https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points_confirmed`

### Query Parameters

| Parameter    | Required | Description                             |
|--------------|----------|-----------------------------------------|
| shop_id      | true     | Your API key                            |
| shop_secret  | true     | Your API secret key                     |
| email*       | true     | User's email                            |
| phone*       | true     | User's phone number                     |
| bonus_points | true     | Bonuses, which client wants to validate |
| sms_code     | true     | SMS code                                |

<aside class="notice">
At least of identifiers (marked by *) must present in request: email, phone. It's used to identify user.
</aside>


### API response

| Name      | Type   | Description       |
|-----------|--------|-------------------|
| status    | String | Response status   |
| confirmed | int    | Validated bonuses |

## Decrease bonuses without SMS code

> Request example

```shell
curl --location --request POST 'https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points?phone=PHONE&shop_id=SHOP_ID&shop_secret=SHOP_SECRET&bonus_points=BONUS_POINTS'
```

> The above command returns JSON structured like this:

```json
{
    "confirmation": "success",
    "confirmed": 123456
}
```

Method decrease bonuses without SMS code.

### HTTP Request

`POST https://<%= config[:api_endpoint] %>/loyalty/basic/use_bonus_points`

### Query Parameters

| Parameter    | Required | Description                             |
|--------------|----------|-----------------------------------------|
| shop_id      | true     | Your API key                            |
| shop_secret  | true     | Your API secret key                     |
| email*       | true     | User's email                            |
| phone*       | true     | User's phone number                     |
| bonus_points | true     | Bonuses, which client wants to validate |

<aside class="notice">
At least of identifiers (marked by *) must present in request: email, phone. It's used to identify user.
</aside>


### API response

| Name      | Type   | Description       |
|-----------|--------|-------------------|
| status    | String | Response status   |
| confirmed | int    | Validated bonuses |
